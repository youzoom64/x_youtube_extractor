# YouTube 動画ダウンロード選択機能

## 概要

YouTube の動画処理時に、動画をダウンロードするかどうかを選択できる機能を追加しました。

## 変更内容

### 1. `workflows/universal_media_transcription.py`

#### 修正箇所

- `execute()` メソッドに `download_video=True` パラメータを追加
- `execute_with_callback()` メソッドに `download_video=True` パラメータを追加
- 動画ダウンロード処理のロジックを修正

#### 動作

- `download_video=True`: 動画をダウンロードして Whisper で高精度文字おこし（DOM 字幕より優先）
- `download_video=False`: DOM 字幕を優先使用し、利用できない場合は処理を終了

### 2. `gui/tkinter_app.py`

#### 修正箇所

- 動画・音声処理フレームに「📥 動画ダウンロード」チェックボックスを追加
- `_start_media_processing()` メソッドでダウンロード選択を取得してワークフローに渡す

#### UI 配置

- 🌐 英語翻訳 | ⏰ タイムスタンプ付与 | **📥 動画 DL+Whisper**

## 使用方法

### GUI（tkinter）

1. 「🎥 動画・音声処理」フレーム内の「📥 動画 DL+Whisper」チェックボックスを操作
2. ✅ チェック済み（デフォルト）: 動画をダウンロードして Whisper で文字おこし
3. ❌ チェック無し: DOM 字幕優先（動画ダウンロードなし）

### プログラム呼び出し

```python
from workflows.universal_media_transcription import UniversalMediaTranscriptionWorkflow

workflow = UniversalMediaTranscriptionWorkflow()

# 動画ダウンロード有効（従来通り）
video_path, text_file, transcription, translation = workflow.execute(
    media_url="https://www.youtube.com/watch?v=...",
    download_video=True
)

# 動画ダウンロード無効（DOM字幕のみ）
video_path, text_file, transcription, translation = workflow.execute(
    media_url="https://www.youtube.com/watch?v=...",
    download_video=False
)
```

## メリット

### 動画ダウンロード有効の場合

- ✅ 確実に文字おこしが可能
- ✅ 高精度な Whisper 文字おこし
- ❌ 動画ファイルサイズ分のディスク使用量
- ❌ ダウンロード時間が必要

### 動画ダウンロード無効の場合

- ✅ 高速処理（ダウンロード時間不要）
- ✅ ディスク容量節約
- ✅ YouTube の字幕が利用可能な場合は十分な精度
- ❌ DOM 字幕が利用できない場合は処理失敗

## 技術詳細

### 処理フロー

1. YouTube ページにアクセスして DOM 字幕取得を試行
2. DOM 字幕が利用可能（50 文字以上）→ DOM 字幕を使用
3. DOM 字幕が利用不可 + `download_video=True` → 動画ダウンロード + Whisper 文字おこし
4. DOM 字幕が利用不可 + `download_video=False` → 処理終了

### ログ出力

```
動画ダウンロード: 有効
DOM字幕が利用できないため動画をダウンロードします
```

または

```
動画ダウンロード: 無効（DOM字幕のみ）
DOM字幕が利用できず、動画ダウンロードも無効のため処理を終了します
```

## テスト

`test_download_option.py` を実行して動作確認が可能です。

```bash
python test_download_option.py
```
